@page
@using Framework

@model Areas.Admin.Pages.IndexModel
@{
    ViewData["Title"] = "پیشخوان";
}
<div class="row">
    <div class="col-lg-3 col-6">
        <div class="stat-box use-cyan shadow">
            <a href="#">
                <div class="stat">
                    <div class="num" style="font-size:large; font-weight:bold;">@Model.StaticData.CustomerCount</div>
                    <div class="h3">تعداد مشتری ها</div>
                </div><!-- /.stat -->
                <div class="visual">
                    <i class="icon-eye"></i>
                </div><!-- /.visual -->
            </a>
        </div><!-- /.stat-box -->
    </div><!-- /.col-lg-3 -->
    <div class="col-lg-3 col-6">
        <div class="stat-box use-blue shadow">
            <a href="#">
                <div class="stat">
                    <div class="num" style="font-size:large; font-weight:bold;">@Model.StaticData.ExpertCount</div>
                    <div class="h3"> تعداد کارشناس ها</div>
                </div><!-- /.stat -->
                <div class="visual">
                    <i class="icon-calculator"></i>
                </div><!-- /.visual -->
            </a>
        </div><!-- /.stat-box -->
    </div><!-- /.col-lg-3 -->
    <div class="col-lg-3 col-6">
        <div class="stat-box use-green shadow">
            <a href="#">
                <div class="stat">
                    <div class="num" style="font-size:large; font-weight:bold;">@Model.StaticData.OrderCount</div>
                    <div class="h3"> تعداد سفارش ها</div>
                </div><!-- /.stat -->
                <div class="visual">
                    <i class="icon-wallet"></i>
                </div><!-- /.visual -->
            </a>
        </div><!-- /.stat-box -->
    </div><!-- /.col-lg-3 -->
    <div class="col-lg-3 col-6">
        <div class="stat-box use-lime shadow">
            <a href="#">
                <div class="stat">
                    <div class="num" style="font-size:large; font-weight:bold;">@Model.StaticData.SuggestionCount</div>
                    <div class="h3">تعداد پیشنهادها</div>
                </div><!-- /.stat -->
                <div class="visual">
                    <i class="icon-heart"></i>
                </div><!-- /.visual -->
            </a>
        </div><!-- /.stat-box -->
    </div><!-- /.col-lg-3 -->
</div><!-- /.row -->
<div class="row">

    <div class="col-xl-6 col-12">
        <div class="portlet box shadow">
            <div class="portlet-heading">
                <div class="portlet-title">
                    <h3 class="title">
                        <i class="icon-speech"></i>
                        آخرین سفارش ها
                    </h3>
                </div><!-- /.portlet-title -->
                <div class="buttons-box">
                    <a class="btn btn-sm btn-default btn-round btn-collapse" rel="tooltip" title="کوچک کردن" href="#">
                        <i class="icon-arrow-up"></i>
                    </a>
                    <a class="btn btn-sm btn-default btn-round btn-close" rel="tooltip" title="بستن" href="#">
                        <i class="icon-trash"></i>
                    </a>
                </div><!-- /.buttons-box -->
            </div><!-- /.portlet-heading -->
            <div class="portlet-body ">
                <div class="table-responsive">
                    <table class="table table-bordered table-striped table-hover">
                        <thead>
                            <tr>
                                <th><i class="icon-energy"></i></th>
                                <th>سفارش دهنده </th>
                                <th>تاریخ</th>
                                <th>هوم سرویس</th>
                                <th>جزییات</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.LastOrders)
                            {
                                <tr>
                                    <td>
                                        <i class="fas fa-arrow-down text-danger"></i>
                                    </td>
                                    <td>
                                        @item.CustomerLname
                                    </td>
                                    <td>@item.CreateAt.ToPersianString("yyyy/MM/dd")</td>
                                    <td>@item.SubServiceName</td>
                                    <td class="text-center">
                                        <a class="btn btn-warning round"
                                           asp-page="/Orders/Details"
                                           asp-area="Admin"
                                           asp-route-id="@item.Id">نمایش </a>
                                    </td>
                                </tr>
                            }

                        </tbody>
                    </table>
                </div><!-- /.table-responsive -->

            </div><!-- /.portlet-body -->
        </div><!-- /.portlet -->
    </div><!-- /.col-xl-6 -->
    <div class="col-xl-6 col-12">
        <div class="portlet box shadow">
            <div class="portlet-heading">
                <div class="portlet-title">
                    <h3 class="title">
                        <i class="icon-speech"></i>
                        آخرین پیشنهادها
                    </h3>
                </div><!-- /.portlet-title -->
                <div class="buttons-box">
                    <a class="btn btn-sm btn-default btn-round btn-collapse" rel="tooltip" title="کوچک کردن" href="#">
                        <i class="icon-arrow-up"></i>
                    </a>
                    <a class="btn btn-sm btn-default btn-round btn-close" rel="tooltip" title="بستن" href="#">
                        <i class="icon-trash"></i>
                    </a>
                </div><!-- /.buttons-box -->
            </div><!-- /.portlet-heading -->
            <div class="portlet-body ">
                <div class="table-responsive">
                    <table class="table table-bordered table-striped table-hover">
                        <thead>
                            <tr>
                                <th><i class="icon-energy"></i></th>
                                <th>هوم سرویس </th>
                                <th>تاریخ</th>
                                <th>کارشناس</th>
                                <th>قیمت پیشنهادی</th>
                                <th>جزییات </th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in @Model.LastSuggestions)
                            {
                                <tr>
                                    <td>
                                        <i class="fas fa-arrow-down text-danger"></i>
                                    </td>
                                    <td>
                                        @item.SubServiceName
                                    </td>
                                    <td> @item.CreateAt.ToPersianString("yyyy/MM/dd")</td>
                                    <td>@item.ExperLname </td>
                                    <td>@item.Price</td>
                                    <td class="text-center">
                                        <button class="btn btn-warning round suggestion-detail-button"
                                                data-id="@item.Id"
                                                data-expert-id="@item.ExpertId">
                                            <!-- اضافه کردن expertId -->
                                            نمایش
                                        </button>
                                    </td>

                                </tr>
                            }

                        </tbody>
                    </table>
                </div><!-- /.table-responsive -->

            </div><!-- /.portlet-body -->
        </div><!-- /.col-xl-6 -->
    </div><!-- /.buttons-box -->
</div><!-- /.portlet-heading -->
<div class="modal fade"
     id="pishnahaddetail"
     tabindex="-1"
     role="dialog"
     aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">جزییات پیشنهاد</h5>
                <button type="button"
                        class="close"
                        data-dismiss="modal"
                        aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <label for="SuggestionDetail_OrderId" class="form-label">شناسه سفارش</label>
                <input id="SuggestionDetail_OrderId" type="text" class="form-control" disabled />
                <label for="SuggestionDetail_ExpertLname" class="form-label">کارشناس</label>
                <input id="SuggestionDetail_ExpertLname" type="text" class="form-control" disabled />
                <label for="SuggestionDetail_Score" class="form-label">میانگین امتیاز کارشناس</label>
                <input id="SuggestionDetail_Score" type="text" class="form-control" disabled />
                <label for="SuggestionDetail_Description" class="form-label">توضیحات</label>
                <input id="SuggestionDetail_Description" type="text" class="form-control" style="height: 100px" disabled />
            </div>
            <div class="modal-footer">
                <button type="button"
                        class="btn btn-secondary mx-2"
                        data-dismiss="modal">
                    بستن
                </button>
                <a id="viewCommentsLink" class="btn btn-success">دیدن کامنت ها</a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // رویداد کلیک برای دکمه‌های باز کردن مودال
            $('.suggestion-detail-button').click(function (e) {
                e.preventDefault(); // جلوگیری از رفتن به یک صفحه جدید
                var id = $(this).data('id');
                var expertId = $(this).data('expert-id'); // دریافت expertId

                $.ajax({
                    url: '?handler=SuggestionDetail&id=' + id + '&expertId=' + expertId, // اضافه کردن expertId به URL
                    type: "GET",
                    dataType: "json", // انتظار دریافت JSON
                    success: function (data) {
                        // پر کردن اطلاعات Modal با استفاده از داده دریافتی
                        $('#SuggestionDetail_OrderId').val(data.orderId);
                        $('#SuggestionDetail_ExpertLname').val(data.expertLname);
                        $('#SuggestionDetail_Score').val(data.score);
                        $('#SuggestionDetail_Description').val(data.description);

                        // به‌روزرسانی لینک دکمه‌ی "دیدن کامنت‌ها"
                        $('#viewCommentsLink').attr('href', '/Admin/Comments/GetByExpert?id=' + data.expertId);

                        // باز کردن Modal
                        $('#pishnahaddetail').modal('show');
                    },
                    error: function (xhr, status, error) {
                        console.error("AJAX request failed:", status, error);
                    }
                });
            });

            // رویداد کلیک برای دکمه‌ی بستن مودال
            $('[data-dismiss="modal"]').click(function () {
                $('#pishnahaddetail').modal('hide'); // بستن مودال
            });
        });
    </script>
    <script src="~/AdminTemplate/assets/plugins/chart.js/dist/Chart.bundle.min.js"></script>
    <script src="~/AdminTemplate/assets/plugins/jquery-incremental-counter/jquery.incremental-counter.min.js"></script>
    <script src="~/AdminTemplate/assets/plugins/ammap3/ammap/ammap.js"></script>
    <script src="~/AdminTemplate/assets/plugins/ammap3/ammap/maps/js/iranHighFa.js"></script>
    <script src="~/AdminTemplate/assets/js/pages/dashboard2.js"></script>

    <script src="~/UserTemplate/js/jquery.min.js"></script>
    <script src="~/UserTemplate/js/popper.min.js"></script>
    <script src="~/UserTemplate/js/bootstrap.min.js"></script>


}



